# Lights

Lights is an application utilizing the Tuya API to automatically change SmartLife/Tuya lights based on your desktop color scheme.

https://github.com/user-attachments/assets/8c471348-b05f-405b-8f79-2ad85abb1e10

> The following application is a very rough/quick implementation of the application I wanted to make. I aim to rewrite this in rust in near future to improve latency and add a widget to control all these.

This implementation relies on [pywal](https://github.com/dylanaraps/pywal) $color12 from the colortheif.py file. Which you can copy and configure to the lights_folder using this script or maybe extend it accordingly.

```bash
#!/bin/bash

# wal_template=$HOME/.config/wal/templates/obsidian.css
wal_cached=$HOME/.cache/wal/colors.json


link_template () {
    ln -sr $wal_cached $1
} 

lights_folder=$HOME/Documents/autolitt

rm $lights_folder/colors.json

cp $wal_cached $autolit_folder/colors.json
# cp $wal_cached $obsidian_vault/.obsidian/obsidian1.css

```

## Overview

This smart lighting system monitors your colors.json file (typically generated by your desktop theme) and automatically updates your connected Tuya/SmartLife smart bulbs to match the color scheme - specifically using the `color10` value from your theme.

Tested on following platforms with Wipro WiFi bulb. [Amazon link](https://www.amazon.in/Enabled-12-Watt-Million-Compatible-Assistant/dp/B07S5TH6BN/)
1. Ubuntu 20.04 LTS
2. Windows 10

## Installation

### Prerequisites

Lights requires [Python 3](https://www.python.org/downloads/) to run.

You'll need a Tuya/SmartLife account with smart bulbs already registered. Download the SmartLife app from [Google Play](https://play.google.com/store/apps/details?id=com.tuya.smartlife) and set up your smart bulbs before proceeding.

### Using devenv (Recommended)

If you have [devenv](https://devenv.sh/) and Nix installed:

```sh
# Clone the repository
git clone https://github.com/yourusername/lights.git
cd lights

# Enter the development environment with all dependencies
devenv up

# Run the daemon
./run_daemon.sh
```

### Manual Setup

```sh
# Clone the repository
git clone https://github.com/yourusername/lights.git
cd lights

# Install dependencies
pip install -r requirements.txt

# Run the application
python lights.py
```

## Configuration

Create a config.json file with your Tuya/SmartLife credentials:

```json
{
  "username": "your-email@example.com",
  "password": "your-password",
  "country_code": "91",
  "application": "smart_life"
}
```

### Notes:

**country_code** : Use "91" for India users, "44" for UK users, "1" for US/Canadian users, etc.

**application** : Use "smart_life" for SmartLife app users or "tuya" for Tuya app users

## Running as a Daemon

For continuous operation in the background:

```sh
# Start the daemon
./run_daemon.sh

# For debugging
./debug.sh
```

The daemon will:
1. Monitor your colors.json file for changes
2. Update your smart lights automatically when the color scheme changes
3. Maintain connection state and retry if connection issues occur
4. Log activity to logs.txt and cache a copy in `~/.cache/lights_daemon.log`

## Troubleshooting

- **Connection errors**: The system will automatically retry connections with exponential backoff.
- **Tuya API rate limits**: If you see a "you cannot auth exceed once in 180 seconds" error, wait at least 3 minutes before restarting.
- **Import errors**: Ensure all dependencies are installed with `pip install -r requirements.txt`.
- **Colors not changing**: Check that your colors.json - file contains a valid `color10` hex code value and you can change the color10 variable as well.

## Development

This project uses:
- watchfiles - for monitoring file changes
- tuyapy - for Tuya API integration 
- asyncio - for asynchronous operation
- Optional development tools via devenv.nix

## Credits

Inspired by:
- [Reddit Post](https://www.reddit.com/r/homeautomation/comments/dz677b/heres_how_to_use_wipros_smart_lights_with_ifttt/)
- [GitHub Repo](https://github.com/dev-est/tuya_tray)
- Color extraction using [colorthief](https://github.com/fengsp/color-thief-py)

## TODO

- [ ] A widget to control the colors with a color wheel or pallete
- [ ] Rewrite in RUST 
- [ ] Dynamic screen resolution and offset settings
- [ ] Better handling of dark and white dominant colors
- [ ] Color temperature adjustments for natural lighting cycles
- [ ] Web UI for configuration
